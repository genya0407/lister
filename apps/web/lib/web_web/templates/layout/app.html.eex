<!doctype html>
<html lang="en" prefix="og: http://ogp.me/ns#">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">

    <title>Lister</title>
  </head>
  <body>
    <div id='main'>
      <ul>
        <li v-for="candidate in candidates">
          {{ candidate.screen_name }}: {{candidate.name}}
          <button v-on:click="add_to_list(candidate.id)">Add</button>
        </li>
      </ul>

      <ul>
        <li v-for="hint in hint_user_screen_names">{{ hint }}</li>
      </ul>
      <input type="text" v-model="new_hint" />
      <button v-on:click="add_hint">Add hint</button>

      <br />
      <button v-on:click="fetch_candidates">Fetch candidates</button>
    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.17/dist/vue.js"></script>
    <script type='text/javascript'>
      const app = new Vue({
        el: '#main',
        data: function(){
          return {
            new_hint: "",
            hint_user_screen_names: [],
            owner_screen_name: "genya0407",
            slug: "r",
            candidates: []
          }
        },
        methods: {
          fetch_candidates: function() {
            const vue = this
            $.get("/api/candidates", {hints: vue.hints, owner_screen_name: vue.owner_screen_name, slug: vue.slug}, (data) => {
              vue.candidates = data.candidates
            })
          },
          add_to_list: function(user_id) {
            const vue = this
            $.ajax({
              url: "/api/candidates",
              type: "POST",
              data: JSON.stringify({user_ids: [user_id], owner_screen_name: vue.owner_screen_name, slug: vue.slug}),
              contentType:"application/json; charset=utf-8",
              dataType:"json",
              success: function(){
                vue.fetch_candidates()
              }
            })
          },
          add_hint: function() {
            this.hint_user_screen_names.push(this.new_hint)
            this.new_hint = ""
          }
        },
        computed: {
          hints: function() {
            return this.hint_user_screen_names.join(",")
          }
        }
      })
    </script>
  </body>
</html>
